version: '3.4'


services:
  nginx:
    image: iss-dev:nginx
    build: ./nginx
    expose:
      - 80
    logging:
      options:
        max-size: "200k"
        max-file: "10"
    ports:
      - 80:80
    depends_on:
      - "gunicorn"
    logging:
      options:
        max-size: "200k"
        max-file: "10"
  gunicorn:
    image: iss-dev:gunicorn
    build: ./django
    depends_on:
    - postgres
    - memcached
    container_name: django-dev
    volumes:
    - ./django:/usr/src/app
    command: "gunicorn issessionsctf.wsgi:application --workers=5 -b 0.0.0.0:8002"
    expose:
      - 8002
    logging:
      options:
        max-size: "200k"
        max-file: "10"
#  django:
#    image: iss-dev:django
#    network_mode: host
#    build: 
#      context: ./django
#    depends_on:
#    - postgres
#    - memcached
#    container_name: django-dev
#    volumes:
#    - ./django:/usr/src/app
  postgres:
    image: iss-dev:postgres
    network_mode: host
    build:
      context: ./postgres
    container_name: postgresql

  memcached:
    image: iss-dev:memcached
    network_mode: host
    build:
      context: ./memcached
    container_name: memcached

